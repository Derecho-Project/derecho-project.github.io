<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Derecho: objectstore/README.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Derecho
   &#160;<span id="projectnumber">0.9</span>
   </div>
   <div id="projectbrief">Distributed systems toolkit for RDMA</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">objectstore/README.md</div>  </div>
</div><!--header-->
<div class="contents">
<a href="objectstore_2README_8md.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;# dPods: The Derecho Plain-Old-Data Store</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;dPods is a high-performant, replicated, and fault-tolerant objectstore service built upon the core functionalities of the Derecho library. We designed dPods with the following objectives in mind:</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;1. Temporal Queries: We log the time of occurence for each operation.  In versioned mode, this allows queries against any stable time in the past.  Queries with the same time that access a set of distinct objects or distinct replicas will be satisfied of a consistent cut across the history. **NOTE: the time-query API has not yet been added.**</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;2. Zero-copy: We use RDMA to move data around for replication or between the server and clients. We try our best to avoid unecessary memory copies, which eat up performance when handling large data objects. **We are working on a slab allocator to allow the application to manage the objects in *RDMA-ready* memory regions, meaning the objects are accessible to RDMA devices and ready to be transferred to remote nodes without any local memory copy.  This should help users design zero-copy objects.**</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;There are three kinds of members (processes) in a dPods Store deployment: The *replicas*, *clients*, and *external clients*. *replicas* store the data and keep a log of all the operations. *clients* put/get/remove the object by issuing Derecho P2P calls to *replicas*. Both *replicas* and *clients* are members of the top level derecho group, and *replicas* are also me,bers of the subgroup managing dPods data and carrying out operations on the data. *External clients* are nodes that talk to *replicas* through some relay services (e.g. RESTful API). The *external clients* focus on language compatibility rather than performance. In the [current version](f379c6eef813c073c28b803c99ab441ea4002975), we haven&#39;t provided a demo implementation illustrating this style of using REST from an external client.</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;dPODS also supports cput (conditional put). This allows the caller to do a put if the object still has some expected version number, but fails if the version has changed, enabling lock-free updates.</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;## dPods Getting Started</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;To access the dPods service, a process need either start a dPods node as *replica* or *client*, or access those service as an *external client*. In this document, we only talk about the former method. We plan to add the latter soon.</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;A dPods *replica* or *client* node needs to start the service and get a handle to it as following:</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;```cpp</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;    // oss - objectstore service</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;    auto&amp; oss = objectstore::IObjectStoreService::getObjectStoreService(argc, argv,</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;        [&amp;](const objectstore::OID&amp; oid, const objectstore::Object&amp; object){</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;            std::cout &lt;&lt; &quot;watcher: &quot; &lt;&lt; oid &lt;&lt; &quot;-&gt;&quot; &lt;&lt; object &lt;&lt; std::endl;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;        });</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;```</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;The `argc` and `argv` are command line arguments carrying derecho configurations to be passed to the derecho core. The third argument is a callable object watching on the updates. For example, in a pub/sub system, a consumer is hoping to be notified of incoming data, which can be handled here. Please note that only the replica nodes will be notified. The client nodes can register a watch but to be ignored.</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;Careful readers may wondering what determines whether a node is a replica,as opposed to a client. We defined this in derecho configuration file. dPods rely on the new options in the `[OBJECTSTORE]` section.</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;```</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;[OBJECTSTORE]</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;# &#39;min_replication_factor&#39; is the minimum number of replicas required to run</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;# an objectstore. </div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;min_replication_factor = 2</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;# &#39;replicas&#39; is a list of nodes (ids) which are in the replica subgroup. The</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;# node IDs are separated by comma(,). Hyphen is allowed for a range.</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;# Examples:</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;# replicas = 0,1,2</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;# replicas = 0-2,9-10,12,30,100-105</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;# The number of replica must be greater than &#39;min_replication_factor&#39;.</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;replicas = 0-2</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;# &#39;persisted&#39; controls the persistence of the ObjectStore. Set it to &#39;true&#39; if</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;# the data need to survive system restarts or failure. </div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;persisted = false</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;# &#39;logged&#39; controls if the history is maintained. Set it to  &#39;true&#39; if access </div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;# to history is required. NOTE: &#39;logged&#39; only works with &#39;persisted&#39; = true. </div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;logged = false</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;```</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;Notice that the node id is defined by the `local_id` in &#39;[DERECHO]&#39; section.</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;Once we get the handle to the ObjectStore service, we can put and get the objects in the store:</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;```cpp</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    // put</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    std::istringstream ss(args);</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    std::string oid,odata;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    ss &gt;&gt; oid &gt;&gt; odata;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    objectstore::Object object(std::stol(oid),odata.c_str(),odata.length()+1);</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    try{</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;        oss.put(object);</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    } catch (...) {</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;        return false;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    }</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    </div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    // get</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    try{</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;        objectstore::Object obj = oss.get(std::stol(args));</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;        std::cout &lt;&lt; obj &lt;&lt; std::endl;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    } catch (...) {</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;        return false;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    }</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    </div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    // remove</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    try{</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        return oss.remove(std::stol(args));</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    } catch (...) {</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        return false;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    }</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;```</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;On application shutdown, the application can close the local store service by calling the `leave` API:</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;```cpp</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    oss.leave();</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;```</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;Please check the example application code in [test.cpp](https://github.com/Derecho-Project/derecho/blob/master/objectstore/test.cpp).</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;## The dPods API</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;The dPods API is shown in [ObjectStore.hpp](https://github.com/Derecho-Project/derecho/blob/master/objectstore/ObjectStore.hpp). TODO: explaining the normal put/get/remove as well as temporal query, conditional-put.</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;## TODO: More on the dPods versions</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div></div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Apr 4 2019 16:24:54 for Derecho by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
