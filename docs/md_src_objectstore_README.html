<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Derecho: dPods: The Derecho Plain-Old-Data Store</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Derecho
   &#160;<span id="projectnumber">0.9</span>
   </div>
   <div id="projectbrief">Distributed systems toolkit for RDMA</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">dPods: The Derecho Plain-Old-Data Store </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>dPods is a high-performant, replicated, and fault-tolerant objectstore service built upon the core functionalities of the Derecho library. We designed dPods with the following objectives in mind:</p><ol type="1">
<li>Temporal Queries: We log the time of occurence for each operation. In versioned mode, this allows queries against any stable time in the past. Queries with the same time that access a set of distinct objects or distinct replicas will be satisfied of a consistent cut across the history. <b>NOTE: the time-query API has not yet been added.</b></li>
<li>Zero-copy: We use RDMA to move data around for replication or between the server and clients. We try our best to avoid unecessary memory copies, which eat up performance when handling large data objects. <b>We are working on a slab allocator to allow the application to manage the objects in <em>RDMA-ready</em> memory regions, meaning the objects are accessible to RDMA devices and ready to be transferred to remote nodes without any local memory copy. This should help users design zero-copy objects.</b></li>
</ol>
<p>There are three kinds of members (processes) in a dPods Store deployment: The <em>replicas</em>, <em>clients</em>, and <em>external clients</em>. <em>replicas</em> store the data and keep a log of all the operations. <em>clients</em> put/get/remove the object by issuing Derecho P2P calls to <em>replicas</em>. Both <em>replicas</em> and <em>clients</em> are members of the top level derecho group, and <em>replicas</em> are also me,bers of the subgroup managing dPods data and carrying out operations on the data. <em>External clients</em> are nodes that talk to <em>replicas</em> through some relay services (e.g. RESTful API). The <em>external clients</em> focus on language compatibility rather than performance. In the [current version](f379c6eef813c073c28b803c99ab441ea4002975), we haven't provided a demo implementation illustrating this style of using REST from an external client.</p>
<p>dPODS also supports cput (conditional put). This allows the caller to do a put if the object still has some expected version number, but fails if the version has changed, enabling lock-free updates.</p>
<h2>dPods Getting Started</h2>
<p>To access the dPods service, a process need either start a dPods node as <em>replica</em> or <em>client</em>, or access those service as an <em>external client</em>. In this document, we only talk about the former method. We plan to add the latter soon.</p>
<p>A dPods <em>replica</em> or <em>client</em> node needs to start the service and get a handle to it as following: </p><div class="fragment"><div class="line"><span class="comment">// oss - objectstore service</span></div><div class="line"><span class="keyword">auto</span>&amp; oss = objectstore::IObjectStoreService::getObjectStoreService(<a class="code" href="ObjectStoreService_8cpp.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="ObjectStoreService_8cpp.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>,</div><div class="line">    [&amp;](<span class="keyword">const</span> objectstore::OID&amp; oid, <span class="keyword">const</span> objectstore::Object&amp; <span class="keywordtype">object</span>){</div><div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;watcher: &quot;</span> &lt;&lt; oid &lt;&lt; <span class="stringliteral">&quot;-&gt;&quot;</span> &lt;&lt; <span class="keywordtype">object</span> &lt;&lt; std::endl;</div><div class="line">    });</div></div><!-- fragment --><p> The <code>argc</code> and <code>argv</code> are command line arguments carrying derecho configurations to be passed to the derecho core. The third argument is a callable object watching on the updates. For example, in a pub/sub system, a consumer is hoping to be notified of incoming data, which can be handled here. Please note that only the replica nodes will be notified. The client nodes can register a watch but to be ignored.</p>
<p>Careful readers may wondering what determines whether a node is a replica,as opposed to a client. We defined this in derecho configuration file. dPods rely on the new options in the <code>[OBJECTSTORE]</code> section. </p><div class="fragment"><div class="line">[OBJECTSTORE]</div><div class="line"># &#39;min_replication_factor&#39; is the minimum number of replicas required to run</div><div class="line"># an objectstore. </div><div class="line">min_replication_factor = 2</div><div class="line"># &#39;replicas&#39; is a list of nodes (ids) which are in the replica subgroup. The</div><div class="line"># node IDs are separated by comma(,). Hyphen is allowed for a range.</div><div class="line"># Examples:</div><div class="line"># replicas = 0,1,2</div><div class="line"># replicas = 0-2,9-10,12,30,100-105</div><div class="line"># The number of replica must be greater than &#39;min_replication_factor&#39;.</div><div class="line">replicas = 0-2</div><div class="line"># &#39;persisted&#39; controls the persistence of the ObjectStore. Set it to &#39;true&#39; if</div><div class="line"># the data need to survive system restarts or failure. </div><div class="line">persisted = false</div><div class="line"># &#39;logged&#39; controls if the history is maintained. Set it to  &#39;true&#39; if access </div><div class="line"># to history is required. NOTE: &#39;logged&#39; only works with &#39;persisted&#39; = true. </div><div class="line">logged = false</div></div><!-- fragment --><p> Notice that the node id is defined by the <code>local_id</code> in '[DERECHO]' section.</p>
<p>Once we get the handle to the ObjectStore service, we can put and get the objects in the store: </p><div class="fragment"><div class="line"><span class="comment">// put</span></div><div class="line">std::istringstream ss(args);</div><div class="line">std::string oid,odata;</div><div class="line">ss &gt;&gt; oid &gt;&gt; odata;</div><div class="line">objectstore::Object object(std::stol(oid),odata.c_str(),odata.length()+1);</div><div class="line"><span class="keywordflow">try</span>{</div><div class="line">    oss.put(<span class="keywordtype">object</span>);</div><div class="line">} <span class="keywordflow">catch</span> (...) {</div><div class="line">    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// get</span></div><div class="line"><span class="keywordflow">try</span>{</div><div class="line">    objectstore::Object obj = oss.get(std::stol(args));</div><div class="line">    std::cout &lt;&lt; obj &lt;&lt; std::endl;</div><div class="line">} <span class="keywordflow">catch</span> (...) {</div><div class="line">    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// remove</span></div><div class="line"><span class="keywordflow">try</span>{</div><div class="line">    <span class="keywordflow">return</span> oss.remove(std::stol(args));</div><div class="line">} <span class="keywordflow">catch</span> (...) {</div><div class="line">    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line">}</div></div><!-- fragment --><p>On application shutdown, the application can close the local store service by calling the <code>leave</code> API: </p><div class="fragment"><div class="line">oss.leave();</div></div><!-- fragment --><p>Please check the example application code in <a href="https://github.com/Derecho-Project/derecho/blob/master/objectstore/test.cpp">test.cpp</a>.</p>
<h2>The dPods API</h2>
<p>The dPods API is shown in <a href="https://github.com/Derecho-Project/derecho/blob/master/objectstore/ObjectStore.hpp">ObjectStore.hpp</a>. TODO: explaining the normal put/get/remove as well as temporal query, conditional-put. </p><h2>TODO: More on the dPods versions</h2>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat Oct 26 2019 21:51:38 for Derecho by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
